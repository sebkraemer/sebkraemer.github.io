<!DOCTYPE html>
<html lang="en"><head>
	
	<meta name="generator" content="Hugo 0.75.1" />
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	
	<meta property="og:title" content="C&#43;&#43; Weekly - Ep 154 - One Simple Trick For Reducing Code Bloat">
	
	
	<meta name="keywords" content="c&#43;&#43;,tl;dr"><meta property="og:title" content="C&#43;&#43; Weekly - Ep 154 - One Simple Trick For Reducing Code Bloat" />
<meta property="og:description" content="A friend sent me the link to this c&#43;&#43; weekly episode and I followed that clickbait. Just recently I met the topic of compiler-generated functions at work so the episode caught some special interest.
So what is it about already? In a nutshell, the episode is about the different amount of compiler-generated assembly output depending on the (non-)definition of the destructor. (I just wonder. Probably this will apply to other non-generated functions as well." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sebkraemer.github.io/posts/cppweekly-ep154-reduce-code-bloat/" />
<meta property="article:published_time" content="2020-12-12T21:56:51+01:00" />
<meta property="article:modified_time" content="2020-12-12T21:56:51+01:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="C&#43;&#43; Weekly - Ep 154 - One Simple Trick For Reducing Code Bloat"/>
<meta name="twitter:description" content="A friend sent me the link to this c&#43;&#43; weekly episode and I followed that clickbait. Just recently I met the topic of compiler-generated functions at work so the episode caught some special interest.
So what is it about already? In a nutshell, the episode is about the different amount of compiler-generated assembly output depending on the (non-)definition of the destructor. (I just wonder. Probably this will apply to other non-generated functions as well."/>

	<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/all.css" />
	<title>C&#43;&#43; Weekly - Ep 154 - One Simple Trick For Reducing Code Bloat | TL;DR dev blog</title></head>
<body><header>
	
	<div id="titletext"><h2 id="title"><a href="https://sebkraemer.github.io/">TL;DR dev blog</a></h2></div>
	<div id="title-description"><div id="social">
			<nav>
				<ul></ul>
			</nav>
		</div>
	</div>
	
	<div id="mainmenu">
		<nav>
			<ul>
				
				<li><a href="/about">About</a></li>
				
				<li><a href="/posts">All Posts</a></li>
				
				<li><a href="categories/fints101">FinTS101</a></li>
				
				<li><a href="/tags">Tags</a></li>
				
				<li><a href="/categories">Categories</a></li>
				
			</ul>
		</nav>
	</div>
	
</header>
<main><div class="post">
	
	<div class="author">
	
	</div>
	<div class="post-header">
	
		<div class="meta">
			
			<div class="date">
				<span class="day">12</span>
				<span class="rest">Dec 2020</span>
			</div>
			
		</div>
		
		<div class="matter">
			<h1 class="title">C&#43;&#43; Weekly - Ep 154 - One Simple Trick For Reducing Code Bloat</h1>
		</div>
	</div>
	<div class="markdown">
		<p>A friend sent me the link to <a href="https://youtu.be/D8eCPl2zit4" target="_blank">this c&#43;&#43; weekly
episode</a> and I followed that clickbait. Just
recently I met the topic of compiler-generated functions at work so the episode
caught some special interest.</p>
<p>So what is it about already? In a nutshell, the episode is about the different
amount of compiler-generated assembly output depending on the (non-)definition
of the destructor. (I just wonder. Probably this will apply to other
non-generated functions as well.)</p>
<p>See this</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">S</span> {
   std<span style="color:#f92672">::</span>string s;
   <span style="color:#75715e">// ~S();
</span><span style="color:#75715e"></span>};

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
{
  std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>S<span style="color:#f92672">&gt;</span> vec;
  vec.emplace_back();
  vec.emplace_back();
}
</code></pre></div><p>vs. changed <code>S</code> destructor here</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">S</span> {
   std<span style="color:#f92672">::</span>string s;
   <span style="color:#f92672">~</span>S();
};
S<span style="color:#f92672">::~</span>S() {}
</code></pre></div><p>Essentially, the episode noted the following:</p>
<ul>
<li>The second case generated more assembly code, especially it contained an
explicit calls to the destructor function.</li>
<li>This did not always happen, e.g. if <code>S</code> contained a native type the destructor
call was optimized away (with <code>-O3</code>).</li>
<li>The rule of zero was advertised.</li>
</ul>
<p>I refrain from getting into more details of what happened when, since that would
not be TL;DR-ish and also because <em>the results have changed since the episode
was published almost two years ago</em>.</p>
<p>For me, the episode was a starter to dive into the <em>trivially-desctructible</em>
topic which crossed my way before, I believe also in one of Jason&rsquo;s episodes.
Was that about multiple destructor&rsquo;s feature in C++20?</p>
<p>My personal takeaways:</p>
<ul>
<li>It&rsquo;s a difference if a class is cleaned up by excecuting a function (i.e.
destructor) and then freeing the memory of just freeing the memory, saving a
possibly empty function call. Reading it that way, that appears obvious now.
The insight for me is apparently that it is possible to free an object without
calling <em>any</em> destrcutor.</li>
<li><del>Just freeing the memory, as I understand it now, this is what <em>trivially
destructible</em> means.</del> I&rsquo;m not sure about this any more, I read up on the
topic a bit and by definition, e.g. the <code>struct S</code> with a <code>std::string</code> is
never trivially destructible since <code>std::string</code> is not trivially
destructible.</li>
<li>Never underestimate the power of compiler optimization. Even what&rsquo;s not
optimized today, might get optimized tomorrow.</li>
</ul>
<p>Maybe it&rsquo;s worth to comment on the last point. In code reviews I&rsquo;ve seen people
argue relentlessly for optimizing code in favor of <em>assumed</em> perfomance (and
possible C++ developers are (in)famous for it). While I would agree that in this
example (or not ever if not needed, for that matter), you should define an empty
destrutor, don&rsquo;t design your code around performance. Clarity for example is
often favorable and it&rsquo;s not clear that even a performance hit that exists with
proof won&rsquo;t get an optimization in the future.</p>
<p>Hope that was TL;DR enough and not too much of a full blog post ;)
I also hope it was useful to you.</p>
<p>References:</p>
<ul>
<li>C++ Weekly episode #154: <a href="https://youtu.be/D8eCPl2zit4">https://youtu.be/D8eCPl2zit4</a></li>
<li><a href="https://en.cppreference.com/w/cpp/language/destructor#Trivial_destructor">https://en.cppreference.com/w/cpp/language/destructor#Trivial_destructor</a></li>
<li>C++17 standard, <a href="https://timsong-cpp.github.io/cppwp/n4659/basic.life#5" target="_blank">ยง6.8.5 Object
Lifetime</a></li>
</ul>
<p>Note to self: I&rsquo;d really like to follow up on ยง6.8.5 and what it means exactly.</p>

	</div>
	
	
	
	
	
	
	
	<div class="tags">
		<div class="taxosfloating_left">
			<p>Categories</p>
		</div>
		<div class="termsfloating_right">
			<p>
			
			
			
			<a href="/categories/c&#43;&#43;weekly/"> c&#43;&#43;weekly </a>
			
			
			
			
			
			
			
			
			
			</p>
		</div>
		<div class="clearit"></div>
		
		
		
		
	
	
	
	<div class="tags">
		<div class="taxosfloating_left">
			<p>Tags</p>
		</div>
		<div class="termsfloating_right">
			<p>
			
			
			
			<a href="/tags/c&#43;&#43;/"> c&#43;&#43; </a>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			<a href="/tags/tldr/"> tldr </a>
			
			
			
			
			
			
			
			</p>
		</div>
		<div class="clearit"></div>
		
		
		
		
		
	</div></div>

  </main>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-RB30ZBH6RS', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




</body>
</html>
